<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Chi ti·∫øt b√°o c√°o</title>
	<link rel="stylesheet" th:href="@{/css/warehouse.css}">
	<style>
		.report-detail-container {
			max-width: 1400px;
			margin: 0 auto;
		}

		.report-hero {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 40px;
			border-radius: 20px;
			margin-bottom: 30px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
		}

		.report-hero-header {
			display: flex;
			justify-content: space-between;
			align-items: start;
			margin-bottom: 20px;
		}

		.report-hero h1 {
			margin: 0;
			font-size: 36px;
		}

		.report-type-badge {
			background: rgba(255, 255, 255, 0.2);
			padding: 10px 20px;
			border-radius: 25px;
			font-size: 16px;
			font-weight: 600;
		}

		.report-meta {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 20px;
			margin-top: 20px;
		}

		.meta-item {
			background: rgba(255, 255, 255, 0.1);
			padding: 15px;
			border-radius: 10px;
		}

		.meta-item label {
			display: block;
			font-size: 12px;
			opacity: 0.8;
			margin-bottom: 5px;
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.meta-item .value {
			font-size: 18px;
			font-weight: 600;
		}

		.kpi-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.kpi-card {
			background: white;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
			position: relative;
			overflow: hidden;
		}

		.kpi-card::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 4px;
		}

		.kpi-card.opening::before {
			background: #3498db;
		}

		.kpi-card.inbound::before {
			background: #27ae60;
		}

		.kpi-card.outbound::before {
			background: #e74c3c;
		}

		.kpi-card.closing::before {
			background: #9b59b6;
		}

		.kpi-card.utilization::before {
			background: #f39c12;
		}

		.kpi-icon {
			font-size: 40px;
			margin-bottom: 15px;
		}

		.kpi-label {
			color: #7f8c8d;
			font-size: 13px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 10px;
		}

		.kpi-value {
			font-size: 42px;
			font-weight: 700;
			color: #2c3e50;
			line-height: 1;
		}

		.kpi-description {
			color: #95a5a6;
			font-size: 13px;
			margin-top: 10px;
		}

		.analysis-section {
			background: white;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
			margin-bottom: 30px;
		}

		.analysis-section h2 {
			color: #2c3e50;
			margin: 0 0 25px 0;
			font-size: 24px;
			border-bottom: 3px solid #667eea;
			padding-bottom: 15px;
			display: inline-block;
		}

		.comparison-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 20px;
			margin-bottom: 20px;
		}

		.comparison-card {
			background: #f8f9fa;
			padding: 20px;
			border-radius: 10px;
			border-left: 4px solid #667eea;
		}

		.comparison-card h4 {
			color: #2c3e50;
			margin: 0 0 15px 0;
			font-size: 16px;
		}

		.comparison-bar {
			background: #e0e0e0;
			height: 30px;
			border-radius: 15px;
			overflow: hidden;
			position: relative;
			margin-bottom: 10px;
		}

		.comparison-fill {
			height: 100%;
			background: linear-gradient(90deg, #667eea, #764ba2);
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 600;
			font-size: 14px;
			transition: width 0.5s ease;
		}

		.detail-table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
		}

		.detail-table th,
		.detail-table td {
			padding: 15px;
			text-align: left;
			border-bottom: 1px solid #f0f0f0;
		}

		.detail-table th {
			background: #f8f9fa;
			font-weight: 600;
			color: #2c3e50;
			text-transform: uppercase;
			font-size: 12px;
			letter-spacing: 0.5px;
		}

		.detail-table tbody tr:hover {
			background: #f8f9fa;
		}

		.chart-wrapper {
			background: white;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
			margin-bottom: 30px;
		}

		.chart-wrapper h3 {
			color: #2c3e50;
			margin: 0 0 20px 0;
			font-size: 20px;
		}

		.chart-container {
			position: relative;
			height: 400px;
		}

		.notes-section {
			background: #fffbf0;
			border-left: 4px solid #f39c12;
			padding: 20px;
			border-radius: 10px;
			margin-bottom: 30px;
		}

		.notes-section h4 {
			color: #f39c12;
			margin: 0 0 10px 0;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.notes-section p {
			color: #555;
			line-height: 1.6;
			margin: 0;
		}

		.action-bar {
			background: white;
			padding: 20px 30px;
			border-radius: 15px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: sticky;
			bottom: 20px;
			z-index: 100;
		}

		.action-buttons {
			display: flex;
			gap: 10px;
		}

		.action-btn {
			padding: 12px 24px;
			border: none;
			border-radius: 8px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.btn-primary {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
		}

		.btn-secondary {
			background: #ecf0f1;
			color: #2c3e50;
		}

		.btn-secondary:hover {
			background: #d5dbdb;
		}

		.btn-danger {
			background: #e74c3c;
			color: white;
		}

		.btn-danger:hover {
			background: #c0392b;
		}

		@media print {

			.action-bar,
			.report-hero .action-buttons {
				display: none !important;
			}
		}
	</style>
</head>

<body>
	<div th:replace="~{fragments/warehouse-header :: header}"></div>

	<div class="container report-detail-container">
		<!-- Hero Section -->
		<div class="report-hero">
			<div class="report-hero-header">
				<div>
					<h1>üìä B√°o C√°o Chi Ti·∫øt</h1>
					<span class="report-type-badge" th:text="${report.reportType}"></span>
				</div>
				<div class="action-buttons">
					<button onclick="window.print()" class="action-btn btn-secondary">
						üñ®Ô∏è In b√°o c√°o
					</button>
					<a th:href="@{/warehouse/reports}" class="action-btn btn-secondary">
						‚Üê Quay l·∫°i
					</a>
				</div>
			</div>

			<div class="report-meta">
				<div class="meta-item">
					<label>T·ª´ ng√†y</label>
					<div class="value" th:text="${#temporals.format(report.startDate, 'dd/MM/yyyy HH:mm')}"></div>
				</div>
				<div class="meta-item">
					<label>ƒê·∫øn ng√†y</label>
					<div class="value" th:text="${#temporals.format(report.endDate, 'dd/MM/yyyy HH:mm')}"></div>
				</div>
				<div class="meta-item">
					<label>Ng∆∞·ªùi t·∫°o</label>
					<div class="value" th:text="${report.createdBy.fullName}"></div>
				</div>
				<div class="meta-item">
					<label>Ng√†y t·∫°o</label>
					<div class="value" th:text="${#temporals.format(report.createdAt, 'dd/MM/yyyy HH:mm')}"></div>
				</div>
			</div>
		</div>

		<!-- KPI Cards -->
		<div class="kpi-grid">
			<div class="kpi-card opening">
				<div class="kpi-icon">üì¶</div>
				<div class="kpi-label">T·ªìn ƒë·∫ßu k·ª≥</div>
				<div class="kpi-value" th:text="${report.openingStock}">0</div>
				<div class="kpi-description">Ki·ªán h√†ng t·∫°i th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu</div>
			</div>

			<div class="kpi-card inbound">
				<div class="kpi-icon">üì•</div>
				<div class="kpi-label">T·ªïng nh·∫≠p kho</div>
				<div class="kpi-value" th:text="${report.totalInboundQuantity}">0</div>
				<div class="kpi-description" th:text="${report.totalInboundReceipts} + ' phi·∫øu nh·∫≠p'"></div>
			</div>

			<div class="kpi-card outbound">
				<div class="kpi-icon">üì§</div>
				<div class="kpi-label">T·ªïng xu·∫•t kho</div>
				<div class="kpi-value" th:text="${report.totalOutboundQuantity}">0</div>
				<div class="kpi-description" th:text="${report.totalOutboundReceipts} + ' phi·∫øu xu·∫•t'"></div>
			</div>

			<div class="kpi-card closing">
				<div class="kpi-icon">üìä</div>
				<div class="kpi-label">T·ªìn cu·ªëi k·ª≥</div>
				<div class="kpi-value" th:text="${report.closingStock}">0</div>
				<div class="kpi-description">Ki·ªán h√†ng c√≤n l·∫°i trong kho</div>
			</div>

			<div class="kpi-card utilization">
				<div class="kpi-icon">‚ö°</div>
				<div class="kpi-label">T·ª∑ l·ªá s·ª≠ d·ª•ng</div>
				<div class="kpi-value" th:text="${#numbers.formatDecimal(report.utilizationRate, 1, 1)} + '%'">0%</div>
				<div class="kpi-description">C√¥ng su·∫•t kho ƒë∆∞·ª£c s·ª≠ d·ª•ng</div>
			</div>
		</div>

		<!-- Notes Section -->
		<div class="notes-section" th:if="${report.notes}">
			<h4>üìù Ghi ch√∫</h4>
			<p th:text="${report.notes}"></p>
		</div>

		<!-- Analysis Section -->
		<div class="analysis-section">
			<h2>üìà Ph√¢n T√≠ch Chi Ti·∫øt</h2>

			<div class="comparison-grid">
				<div class="comparison-card">
					<h4>Hi·ªáu su·∫•t nh·∫≠p kho</h4>
					<div class="comparison-bar">
						<div class="comparison-fill"
							th:style="'width: ' + ${report.totalInboundQuantity > 0 ? (report.totalInboundQuantity * 100.0 / (report.totalInboundQuantity + report.totalOutboundQuantity)) : 0} + '%'"
							th:text="${report.totalInboundQuantity}">
						</div>
					</div>
					<p style="color: #27ae60; font-weight: 600; margin: 0;">
						<span th:text="${report.totalInboundReceipts}">0</span> phi·∫øu nh·∫≠p
					</p>
				</div>

				<div class="comparison-card">
					<h4>Hi·ªáu su·∫•t xu·∫•t kho</h4>
					<div class="comparison-bar">
						<div class="comparison-fill"
							th:style="'width: ' + ${report.totalOutboundQuantity > 0 ? (report.totalOutboundQuantity * 100.0 / (report.totalInboundQuantity + report.totalOutboundQuantity)) : 0} + '%'"
							th:text="${report.totalOutboundQuantity}">
						</div>
					</div>
					<p style="color: #e74c3c; font-weight: 600; margin: 0;">
						<span th:text="${report.totalOutboundReceipts}">0</span> phi·∫øu xu·∫•t
					</p>
				</div>

				<div class="comparison-card">
					<h4>M·ª©c ƒë·ªô lu√¢n chuy·ªÉn</h4>
					<div class="comparison-bar">
						<div class="comparison-fill"
							th:style="'width: ' + ${report.openingStock > 0 ? ((report.totalInboundQuantity + report.totalOutboundQuantity) * 100.0 / report.openingStock) : 0} + '%'"
							th:text="${report.totalInboundQuantity + report.totalOutboundQuantity}">
						</div>
					</div>
					<p style="color: #9b59b6; font-weight: 600; margin: 0;">
						T·ªïng giao d·ªãch trong k·ª≥
					</p>
				</div>
			</div>

			<table class="detail-table">
				<thead>
					<tr>
						<th>Ch·ªâ ti√™u</th>
						<th>Gi√° tr·ªã</th>
						<th>ƒê∆°n v·ªã</th>
						<th>Ghi ch√∫</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>T·ªìn kho ƒë·∫ßu k·ª≥</td>
						<td><strong th:text="${report.openingStock}">0</strong></td>
						<td>Ki·ªán</td>
						<td>S·ªë l∆∞·ª£ng h√†ng t·ªìn kho l√∫c b·∫Øt ƒë·∫ßu k·ª≥ b√°o c√°o</td>
					</tr>
					<tr>
						<td>S·ªë l∆∞·ª£ng nh·∫≠p kho</td>
						<td style="color: #27ae60;"><strong th:text="'+' + ${report.totalInboundQuantity}">0</strong>
						</td>
						<td>Ki·ªán</td>
						<td th:text="'Qua ' + ${report.totalInboundReceipts} + ' phi·∫øu nh·∫≠p'"></td>
					</tr>
					<tr>
						<td>S·ªë l∆∞·ª£ng xu·∫•t kho</td>
						<td style="color: #e74c3c;"><strong th:text="'-' + ${report.totalOutboundQuantity}">0</strong>
						</td>
						<td>Ki·ªán</td>
						<td th:text="'Qua ' + ${report.totalOutboundReceipts} + ' phi·∫øu xu·∫•t'"></td>
					</tr>
					<tr style="background: #f8f9fa;">
						<td><strong>T·ªìn kho cu·ªëi k·ª≥</strong></td>
						<td><strong style="font-size: 18px;" th:text="${report.closingStock}">0</strong></td>
						<td>Ki·ªán</td>
						<td>S·ªë l∆∞·ª£ng h√†ng t·ªìn kho l√∫c k·∫øt th√∫c k·ª≥ b√°o c√°o</td>
					</tr>
					<tr>
						<td>T·ª∑ l·ªá s·ª≠ d·ª•ng kho</td>
						<td><strong th:text="${#numbers.formatDecimal(report.utilizationRate, 1, 2)} + '%'">0%</strong>
						</td>
						<td>%</td>
						<td th:text="'C√¥ng su·∫•t: ' + ${report.warehouse.totalCapacity} + ' ki·ªán'"></td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Charts -->
		<div class="chart-wrapper">
			<h3>üìä Bi·ªÉu ƒê·ªì Ph√¢n T√≠ch Nh·∫≠p/Xu·∫•t</h3>
			<div class="chart-container">
				<canvas id="flowChart"></canvas>
			</div>
		</div>

		<div class="chart-wrapper">
			<h3>ü•ß Bi·ªÉu ƒê·ªì C∆° C·∫•u</h3>
			<div class="chart-container">
				<canvas id="pieChart"></canvas>
			</div>
		</div>

		<!-- Action Bar -->
		<div class="action-bar">
			<div>
				<strong style="color: #2c3e50;">B√°o c√°o:</strong>
				<span th:text="${report.reportType}"></span>
				<span style="color: #95a5a6; margin: 0 10px;">|</span>
				<span
					th:text="${#temporals.format(report.startDate, 'dd/MM/yyyy')} + ' - ' + ${#temporals.format(report.endDate, 'dd/MM/yyyy')}"></span>
			</div>
			<div class="action-buttons">
				<button onclick="exportToPDF()" class="action-btn btn-primary">
					üìÑ Xu·∫•t PDF
				</button>
				<button onclick="exportToExcel()" class="action-btn btn-primary">
					üìä Xu·∫•t Excel
				</button>
				<button onclick="window.print()" class="action-btn btn-secondary">
					üñ®Ô∏è In
				</button>
				<form th:action="@{/warehouse/reports/{id}/delete(id=${report.id})}" method="post"
					style="display: contents;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√°o c√°o n√†y?')">
					<button type="submit" class="action-btn btn-danger">
						üóëÔ∏è X√≥a
					</button>
				</form>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<script th:inline="javascript">
		const report = /*[[${report}]]*/ {};

		// Flow Chart
		const ctx1 = document.getElementById('flowChart');
		if (ctx1) {
			new Chart(ctx1, {
				type: 'bar',
				data: {
					labels: ['T·ªìn ƒë·∫ßu k·ª≥', 'Nh·∫≠p kho', 'Xu·∫•t kho', 'T·ªìn cu·ªëi k·ª≥'],
					datasets: [{
						label: 'S·ªë l∆∞·ª£ng (ki·ªán)',
						data: [
							report.openingStock,
							report.totalInboundQuantity,
							report.totalOutboundQuantity,
							report.closingStock
						],
						backgroundColor: [
							'rgba(52, 152, 219, 0.8)',
							'rgba(39, 174, 96, 0.8)',
							'rgba(231, 76, 60, 0.8)',
							'rgba(155, 89, 182, 0.8)'
						],
						borderColor: [
							'#3498db',
							'#27ae60',
							'#e74c3c',
							'#9b59b6'
						],
						borderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false },
						title: {
							display: true,
							text: 'Bi·∫øn ƒë·ªông t·ªìn kho trong k·ª≥',
							font: { size: 16 }
						}
					},
					scales: {
						y: { beginAtZero: true }
					}
				}
			});
		}

		// Pie Chart
		const ctx2 = document.getElementById('pieChart');
		if (ctx2) {
			new Chart(ctx2, {
				type: 'doughnut',
				data: {
					labels: ['Nh·∫≠p kho', 'Xu·∫•t kho', 'T·ªìn kho'],
					datasets: [{
						data: [
							report.totalInboundQuantity,
							report.totalOutboundQuantity,
							report.closingStock
						],
						backgroundColor: [
							'rgba(39, 174, 96, 0.8)',
							'rgba(231, 76, 60, 0.8)',
							'rgba(155, 89, 182, 0.8)'
						],
						borderColor: ['#27ae60', '#e74c3c', '#9b59b6'],
						borderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { position: 'bottom' },
						title: {
							display: true,
							text: 'C∆° c·∫•u h√†ng h√≥a',
							font: { size: 16 }
						}
					}
				}
			});
		}

		function exportToPDF() {
			window.print();
		}

		function exportToExcel() {
			window.location.href = '/warehouse/reports/' + report.id + '/export/excel';
		}
	</script>
</body>

</html>