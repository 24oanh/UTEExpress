<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Chuyển vị trí</title>
    <link rel="stylesheet" th:href="@{/css/warehouse.css}">
</head>

<body>
    <div th:replace="~{fragments/warehouse-header :: header}"></div>
    <div class="container">
        <h1>Chuyển vị trí kiện hàng</h1>
        <form th:action="@{/warehouse/inventory/transactions/transfer-location}" method="post" class="form">
            <div class="form-group">
                <label>Vị trí hiện tại *</label>
                <select name="fromLocationId" id="fromLocation" required onchange="loadPackagesAtLocation(this.value)">
                    <option value="">-- Chọn vị trí nguồn --</option>
                    <option th:each="loc : ${occupiedLocations}" th:value="${loc.id}"
                        th:text="${loc.locationCode + ' - ' + (loc.packageItem != null ? loc.packageItem.packageCode : '')}">
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label>Kiện hàng *</label>
                <select name="packageId" id="packageSelect" required disabled>
                    <option value="">-- Chọn vị trí nguồn trước --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Vị trí đích *</label>
                <select name="toLocationId" required>
                    <option value="">-- Chọn vị trí đích --</option>
                    <option th:each="loc : ${emptyLocations}" th:value="${loc.id}"
                        th:text="${loc.locationCode + ' (' + loc.zone + '-' + loc.rack + '-' + loc.level + ')'}">
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label>Ghi chú</label>
                <textarea name="notes" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-primary">Chuyển</button>
                <a th:href="@{/warehouse/inventory/transactions}" class="btn-secondary">Hủy</a>
            </div>
        </form>
    </div>
    <script th:inline="javascript">
        const occupiedLocations = /*[[${occupiedLocations}]]*/[];

        function loadPackagesAtLocation(locationId) {
            const packageSelect = document.getElementById('packageSelect');
            packageSelect.disabled = !locationId;

            if (!locationId) {
                packageSelect.innerHTML = '<option value="">-- Chọn vị trí nguồn trước --</option>';
                return;
            }

            const location = occupiedLocations.find(loc => loc.id == locationId);
            if (location && location.packageItem) {
                packageSelect.innerHTML = `<option value="${location.packageItem.id}" selected>${location.packageItem.packageCode}</option>`;
            } else {
                packageSelect.innerHTML = '<option value="">Không có kiện hàng</option>';
            }
        }
    </script>
</body>

</html>