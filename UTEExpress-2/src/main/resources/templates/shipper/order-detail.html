<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chi tiáº¿t Ä‘Æ¡n hÃ ng</title>
<link rel="stylesheet" th:href="@{/css/shipper.css}">
<style>
/* Upload Section */
.upload-section {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	padding: 25px;
	border-radius: 12px;
	margin-top: 25px;
	color: white;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.upload-section h3 {
	color: white;
	margin-bottom: 15px;
	font-size: 1.3em;
}

/* Image Preview */
.upload-preview {
	margin-top: 15px;
	max-width: 350px;
	background: white;
	padding: 10px;
	border-radius: 8px;
}

.upload-preview img {
	width: 100%;
	border-radius: 8px;
	border: 3px solid #667eea;
}

.proof-image-display {
	max-width: 400px;
	margin-top: 15px;
	padding: 10px;
	background: #f0f8ff;
	border-radius: 8px;
}

.proof-image-display img {
	width: 100%;
	border-radius: 8px;
	border: 3px solid #17a2b8;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Buttons */
.camera-button {
	display: inline-block;
	padding: 12px 24px;
	background: #4CAF50;
	color: white;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	font-weight: bold;
	font-size: 16px;
	transition: all 0.3s;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
}

.camera-button:hover {
	background: #45a049;
	transform: translateY(-2px);
	box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.camera-button:active {
	transform: translateY(0);
}

.btn-fail {
	background: #dc3545;
	color: white;
	padding: 12px 24px;
	border: none;
	border-radius: 8px;
	font-weight: bold;
	cursor: pointer;
	transition: all 0.3s;
}

.btn-fail:hover {
	background: #c82333;
	transform: translateY(-2px);
}

.btn-location {
	background: #007bff;
	color: white;
	padding: 12px 24px;
	border: none;
	border-radius: 8px;
	font-weight: bold;
	cursor: pointer;
	transition: all 0.3s;
}

.btn-location:hover {
	background: #0056b3;
	transform: translateY(-2px);
}

.map-button {
	display: inline-block;
	padding: 10px 20px;
	background: #007bff;
	color: white;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	text-decoration: none;
	transition: all 0.3s;
	margin-top: 10px;
}

.map-button:hover {
	background: #0056b3;
	transform: translateY(-2px);
}

/* Form Groups */
.form-group {
	margin-bottom: 20px;
}

.form-group label {
	display: block;
	margin-bottom: 8px;
	font-weight: bold;
	color: white;
}

.form-group textarea {
	width: 100%;
	padding: 12px;
	border: 2px solid rgba(255, 255, 255, 0.3);
	border-radius: 8px;
	font-size: 14px;
	background: rgba(255, 255, 255, 0.9);
	color: #333;
	box-sizing: border-box;
}

.form-group textarea:focus {
	outline: none;
	border-color: #4CAF50;
	background: white;
}

/* Action Sections */
.action-section {
	background: #f8f9fa;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #e9ecef;
}

.action-section h3 {
	color: #495057;
	margin-bottom: 15px;
}

.action-buttons {
	display: flex;
	gap: 10px;
	margin-top: 20px;
	flex-wrap: wrap;
}

.location-update-section {
	background: #e7f3ff;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #007bff;
}

.location-update-section h3 {
	color: #004085;
	margin-bottom: 15px;
}

.fail-section {
	background: #fff3cd;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #ffc107;
}

.fail-section h3 {
	color: #856404;
	margin-bottom: 15px;
}

.fail-section .form-group label {
	color: #856404;
}

/* Status Indicators */
.status-indicator {
	display: inline-block;
	padding: 8px 16px;
	border-radius: 20px;
	font-weight: bold;
	margin: 10px 0;
}

.status-pending {
	background: #fff3cd;
	color: #856404;
}

.status-transit, .status-in_transit {
	background: #d1ecf1;
	color: #0c5460;
}

.status-delivered {
	background: #d4edda;
	color: #155724;
}

.status-failed {
	background: #f8d7da;
	color: #721c24;
}

/* Messages */
.success-message {
	background: #d4edda;
	color: #155724;
	padding: 15px;
	border-radius: 8px;
	margin-bottom: 20px;
	border: 1px solid #c3e6cb;
}

.error-message {
	background: #f8d7da;
	color: #721c24;
	padding: 15px;
	border-radius: 8px;
	margin-bottom: 20px;
	border: 1px solid #f5c6cb;
}

#location-status {
	margin-top: 10px;
	padding: 10px;
	border-radius: 5px;
	font-weight: bold;
}

/* Timeline */
.timeline {
	position: relative;
	padding: 20px 0;
	margin-bottom: 30px;
}

.timeline-item {
	display: flex;
	gap: 15px;
	margin-bottom: 20px;
	position: relative;
}

.timeline-icon {
	width: 40px;
	height: 40px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 20px;
	flex-shrink: 0;
}

.timeline-content {
	flex: 1;
	padding: 15px;
	background: white;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.step-completed .timeline-icon {
	background: #28a745;
	color: white;
}

.step-active .timeline-icon {
	background: #ffc107;
	color: white;
}

.step-pending .timeline-icon {
	background: #6c757d;
	color: white;
}

/* Warning Section */
.warning-section {
	background: #fff3cd;
	padding: 20px;
	border-radius: 10px;
	border: 2px solid #ffc107;
	margin-top: 20px;
}

.warning-section h3 {
	color: #856404;
	margin-bottom: 10px;
}

.warning-section p {
	color: #856404;
	margin: 0;
}
</style>
</head>
<body>
	<div th:replace="~{fragments/shipper-header :: header}"></div>
	
	<div class="container">
		<!-- Alert Messages -->
		<div th:if="${success}" class="success-message" th:text="${success}"></div>
		<div th:if="${error}" class="error-message" th:text="${error}"></div>

		<!-- Page Header -->
		<div class="page-header">
			<h1>Chi tiáº¿t Ä‘Æ¡n hÃ ng</h1>
			<a th:href="@{/shipper/orders}" class="btn-secondary">â† Quay láº¡i</a>
		</div>

		<!-- Timeline Progress (chá»‰ hiá»ƒn thá»‹ khi cÃ³ shipment) -->
		<div class="timeline" th:if="${shipment != null}">
			<div class="timeline-item"
				th:classappend="${shipment.pickupTime != null ? 'step-completed' : 'step-pending'}">
				<div class="timeline-icon">ğŸ“¦</div>
				<div class="timeline-content">
					<strong>1. Nháº­n hÃ ng tá»« kho</strong>
					<p th:if="${shipment.pickupTime}"
						th:text="'âœ“ ' + ${#temporals.format(shipment.pickupTime, 'dd/MM/yyyy HH:mm')}"></p>
					<p th:unless="${shipment.pickupTime}" style="color: #6c757d;">ChÆ°a nháº­n hÃ ng</p>
				</div>
			</div>

			<div class="timeline-item"
				th:classappend="${shipment.status.name() == 'IN_TRANSIT' ? 'step-active' : (shipment.status.name() == 'DELIVERED' ? 'step-completed' : 'step-pending')}">
				<div class="timeline-icon">ğŸšš</div>
				<div class="timeline-content">
					<strong>2. Äang váº­n chuyá»ƒn</strong>
					<p th:if="${shipment.status.name() == 'IN_TRANSIT'}">â³ Äang giao hÃ ng</p>
					<p th:if="${shipment.status.name() == 'DELIVERED'}">âœ“ ÄÃ£ hoÃ n thÃ nh váº­n chuyá»ƒn</p>
					<p th:if="${shipment.status.name() == 'PENDING'}" style="color: #6c757d;">ChÆ°a báº¯t Ä‘áº§u</p>
				</div>
			</div>

			<div class="timeline-item"
				th:classappend="${shipment.status.name() == 'DELIVERED' ? 'step-completed' : 'step-pending'}">
				<div class="timeline-icon">âœ…</div>
				<div class="timeline-content">
					<strong>3. Giao hÃ ng thÃ nh cÃ´ng</strong>
					<p th:if="${shipment.deliveryTime}"
						th:text="'âœ“ ' + ${#temporals.format(shipment.deliveryTime, 'dd/MM/yyyy HH:mm')}"></p>
					<p th:unless="${shipment.deliveryTime}" style="color: #6c757d;">ChÆ°a hoÃ n thÃ nh</p>
				</div>
			</div>
		</div>

		<!-- ThÃ´ng tin Ä‘Æ¡n hÃ ng -->
		<div class="detail-grid">
			<div class="detail-card">
				<h3>ğŸ“‹ ThÃ´ng tin Ä‘Æ¡n</h3>
				<p><strong>MÃ£ Ä‘Æ¡n:</strong> <span th:text="${order.orderCode}"></span></p>
				<p><strong>Tráº¡ng thÃ¡i:</strong> <span th:class="'badge badge-' + ${order.status}" th:text="${order.status}"></span></p>
				<p><strong>PhÃ­ váº­n chuyá»ƒn:</strong> <span th:text="${#numbers.formatDecimal(order.shipmentFee, 0, 'COMMA', 0, 'POINT')} + ' Ä‘'"></span></p>
				<p><strong>Ghi chÃº:</strong> <span th:text="${order.notes ?: '-'}"></span></p>
			</div>

			<div class="detail-card">
				<h3>ğŸ“¤ NgÆ°á»i gá»­i</h3>
				<p><strong>TÃªn:</strong> <span th:text="${order.senderName}"></span></p>
				<p><strong>SÄT:</strong> <a th:href="'tel:' + ${order.senderPhone}" th:text="${order.senderPhone}" style="color: #007bff; text-decoration: none;">ğŸ“</a></p>
				<p><strong>Äá»‹a chá»‰:</strong> <span th:text="${order.senderAddress}"></span></p>
			</div>

			<div class="detail-card">
				<h3>ğŸ“¥ NgÆ°á»i nháº­n</h3>
				<p><strong>TÃªn:</strong> <span th:text="${order.recipientName}"></span></p>
				<p><strong>SÄT:</strong> <a th:href="'tel:' + ${order.recipientPhone}" th:text="${order.recipientPhone}" style="color: #007bff; text-decoration: none;">ğŸ“</a></p>
				<p><strong>Äá»‹a chá»‰:</strong> <span th:text="${order.recipientAddress}"></span></p>
				<button onclick="openMap()" class="map-button">ğŸ—ºï¸ Má»Ÿ báº£n Ä‘á»“</button>
			</div>
		</div>

		<!-- Danh sÃ¡ch kiá»‡n hÃ ng -->
		<div class="section">
			<h3>ğŸ“¦ Danh sÃ¡ch kiá»‡n hÃ ng</h3>
			<table>
				<thead>
					<tr>
						<th>MÃ£ kiá»‡n</th>
						<th>MÃ´ táº£</th>
						<th>Trá»ng lÆ°á»£ng</th>
						<th>KÃ­ch thÆ°á»›c</th>
						<th>Tráº¡ng thÃ¡i</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="pkg : ${packages}">
						<td th:text="${pkg.packageCode}"></td>
						<td th:text="${pkg.description}"></td>
						<td th:text="${pkg.weight} + ' kg'"></td>
						<td th:text="${pkg.length} + 'x' + ${pkg.width} + 'x' + ${pkg.height} + ' cm'"></td>
						<td><span th:class="'badge badge-' + ${pkg.status}" th:text="${pkg.status}"></span></td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- ThÃ´ng tin giao hÃ ng -->
		<div class="section" th:if="${shipment != null}">
			<h3>ğŸšš ThÃ´ng tin giao hÃ ng</h3>
			<div class="detail-card">
				<p><strong>MÃ£ giao hÃ ng:</strong> <span th:text="${shipment.shipmentCode}"></span></p>
				<p><strong>Tráº¡ng thÃ¡i:</strong> <span th:class="'status-indicator status-' + ${shipment.status.name().toLowerCase()}" th:text="${shipment.status}"></span></p>
				<p th:if="${shipment.shipper != null}"><strong>Shipper:</strong> <span th:text="${shipment.shipper.name + ' (' + shipment.shipper.code + ')'}"></span></p>
				<p th:if="${shipment.pickupTime}"><strong>â° Thá»i gian láº¥y:</strong> <span th:text="${#temporals.format(shipment.pickupTime, 'dd/MM/yyyy HH:mm')}"></span></p>
				<p th:if="${shipment.deliveryTime}"><strong>âœ… Thá»i gian giao:</strong> <span th:text="${#temporals.format(shipment.deliveryTime, 'dd/MM/yyyy HH:mm')}"></span></p>
				<p th:if="${shipment.notes}"><strong>ğŸ“ Ghi chÃº:</strong> <span th:text="${shipment.notes}"></span></p>

				<!-- Hiá»ƒn thá»‹ áº£nh Ä‘Ã£ upload -->
				<div th:if="${shipment.proofImageUrl}" class="proof-image-display">
					<strong>ğŸ“¸ áº¢nh chá»©ng tá»« Ä‘Ã£ giao:</strong><br>
					<img th:src="${shipment.proofImageUrl}" alt="áº¢nh chá»©ng tá»« giao hÃ ng">
				</div>
			</div>
		</div>

		<!-- ACTION 1: PENDING - Nháº­n hÃ ng vÃ  báº¯t Ä‘áº§u -->
		<div class="action-section" th:if="${shipment != null && shipment.status.name() == 'PENDING'}">
			<h3>ğŸ¯ HÃ nh Ä‘á»™ng tiáº¿p theo</h3>
			<p style="color: #666; margin-bottom: 15px;">âš ï¸ Vui lÃ²ng nháº­n hÃ ng tá»« kho vÃ  báº¯t Ä‘áº§u váº­n chuyá»ƒn</p>
			<div class="action-buttons">
				<form th:action="@{/shipper/shipments/{id}/receive(id=${shipment.id})}" method="post" style="display: inline-block;">
					<button type="submit" class="btn-primary">ğŸ“¦ 1. XÃ¡c nháº­n nháº­n hÃ ng</button>
				</form>
				<form th:action="@{/shipper/shipments/{id}/start(id=${shipment.id})}" method="post" style="display: inline-block;">
					<button type="submit" class="btn-success">ğŸšš 2. Báº¯t Ä‘áº§u váº­n chuyá»ƒn</button>
				</form>
			</div>
		</div>

		<!-- ACTION 2: IN_TRANSIT - Upload áº£nh vÃ  hoÃ n thÃ nh -->
		<div class="upload-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>ğŸ“· HoÃ n thÃ nh giao hÃ ng</h3>
			<p style="margin-bottom: 15px; font-size: 14px;">âœ… ÄÆ¡n hÃ ng Ä‘ang váº­n chuyá»ƒn. Vui lÃ²ng chá»¥p áº£nh xÃ¡c nháº­n khi giao hÃ ng thÃ nh cÃ´ng.</p>

			<form th:action="@{/shipper/shipments/{id}/complete(id=${shipment.id})}" method="post" enctype="multipart/form-data" id="uploadProofForm">
				<div class="form-group">
					<label>ğŸ“¸ áº¢nh chá»©ng tá»« giao hÃ ng *</label>
					<button type="button" class="camera-button" onclick="document.getElementById('proofImageInput').click()">
						ğŸ“· Chá»¥p áº£nh / Chá»n tá»« thÆ° viá»‡n
					</button>
					<input type="file" id="proofImageInput" name="proofImage" accept="image/*" capture="environment" style="display: none;" onchange="previewImage(this)" required>
					<div id="imagePreview" class="upload-preview"></div>
				</div>

				<div class="form-group">
					<label>ğŸ“ Ghi chÃº (tÃ¹y chá»n)</label>
					<textarea name="notes" rows="3" placeholder="Ghi chÃº vá» viá»‡c giao hÃ ng (vÃ­ dá»¥: ÄÃ£ giao cho ngÆ°á»i nháº­n, kÃ½ nháº­n Ä‘áº§y Ä‘á»§...)"></textarea>
				</div>

				<button type="submit" class="btn-success btn-lg" style="width: 100%;">âœ“ HoÃ n thÃ nh giao hÃ ng</button>
			</form>
		</div>

		<!-- ACTION 3: IN_TRANSIT - Cáº­p nháº­t vá»‹ trÃ­ -->
		<div class="location-update-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>ğŸ“ Cáº­p nháº­t vá»‹ trÃ­</h3>
			<p style="color: #004085; margin-bottom: 15px;">Cáº­p nháº­t vá»‹ trÃ­ hiá»‡n táº¡i Ä‘á»ƒ khÃ¡ch hÃ ng theo dÃµi Ä‘Æ¡n hÃ ng</p>
			<button onclick="updateLocation()" class="btn-location">ğŸ“¡ Cáº­p nháº­t vá»‹ trÃ­ hiá»‡n táº¡i</button>
			<div id="location-status"></div>
		</div>

		<!-- ACTION 4: BÃ¡o tháº¥t báº¡i -->
		<div class="fail-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>âš ï¸ BÃ¡o giao hÃ ng tháº¥t báº¡i</h3>
			<p style="color: #856404; margin-bottom: 15px;">Chá»‰ sá»­ dá»¥ng khi khÃ´ng thá»ƒ giao hÃ ng (ngÆ°á»i nháº­n khÃ´ng cÃ³ máº·t, Ä‘á»‹a chá»‰ sai, tá»« chá»‘i nháº­n hÃ ng...)</p>

			<form th:action="@{/shipper/shipments/{id}/fail(id=${shipment.id})}" method="post" enctype="multipart/form-data" id="failForm" onsubmit="return confirm('âš ï¸ XÃ¡c nháº­n bÃ¡o giao hÃ ng THáº¤T Báº I?');">
				<div class="form-group">
					<label>ğŸ“ LÃ½ do tháº¥t báº¡i *</label>
					<textarea name="notes" rows="3" required placeholder="Vui lÃ²ng mÃ´ táº£ chi tiáº¿t lÃ½ do khÃ´ng thá»ƒ giao hÃ ng..."></textarea>
				</div>

				<div class="form-group">
					<label>ğŸ“¸ áº¢nh minh chá»©ng (náº¿u cÃ³)</label>
					<button type="button" class="camera-button" style="background: #ffc107;" onclick="document.getElementById('failImageInput').click()">
						ğŸ“· Chá»¥p áº£nh minh chá»©ng
					</button>
					<input type="file" id="failImageInput" name="proofImage" accept="image/*" capture="environment" style="display: none;" onchange="previewFailImage(this)">
					<div id="failImagePreview" class="upload-preview"></div>
				</div>

				<button type="submit" class="btn-fail" style="width: 100%;">âš ï¸ XÃ¡c nháº­n giao hÃ ng tháº¥t báº¡i</button>
			</form>
		</div>

		<!-- Cáº£nh bÃ¡o chÆ°a cÃ³ shipment -->
		<div class="warning-section" th:if="${shipment == null}">
			<h3>âš ï¸ ÄÆ¡n hÃ ng chÆ°a cÃ³ Shipment</h3>
			<p>Vui lÃ²ng chá» warehouse táº¡o shipment cho Ä‘Æ¡n hÃ ng nÃ y.</p>
			
			<!-- NÃºt táº¡o shipment cho warehouse (náº¿u cáº§n) -->
			<div th:if="${order.status.name() == 'CHO_GIAO'}" style="margin-top: 15px;">
				<form th:action="@{/warehouse/orders/{id}/create-shipment(id=${order.id})}" method="post">
					<button type="submit" class="btn-primary">ğŸ“¦ Táº¡o Shipment</button>
				</form>
			</div>
		</div>
	</div>

	<script th:inline="javascript">
		/*<![CDATA[*/
		const orderRecipientAddress = /*[[${order.recipientAddress}]]*/ '';
		const shipmentId = /*[[${shipment?.id}]]*/ null;
		/*]]>*/

		function openMap() {
			if (!orderRecipientAddress) {
				alert('âš ï¸ KhÃ´ng cÃ³ Ä‘á»‹a chá»‰ ngÆ°á»i nháº­n');
				return;
			}
			window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(orderRecipientAddress)}`, '_blank');
		}

		function previewImage(input) {
			const preview = document.getElementById('imagePreview');
			
			if (input.files && input.files[0]) {
				const file = input.files[0];
				
				// Kiá»ƒm tra kÃ­ch thÆ°á»›c file (max 5MB)
				if (file.size > 5 * 1024 * 1024) {
					alert('âš ï¸ KÃ­ch thÆ°á»›c áº£nh quÃ¡ lá»›n. Vui lÃ²ng chá»n áº£nh nhá» hÆ¡n 5MB');
					input.value = '';
					preview.innerHTML = '';
					return;
				}
				
				const reader = new FileReader();
				reader.onload = function(e) {
					preview.innerHTML = `
						<img src="${e.target.result}" alt="Preview">
						<p style="color: #28a745; margin-top: 10px; font-weight: bold; text-align: center;">
							âœ“ ÄÃ£ chá»n áº£nh
						</p>
					`;
				}
				reader.readAsDataURL(file);
			}
		}

		function previewFailImage(input) {
			const preview = document.getElementById('failImagePreview');
			
			if (input.files && input.files[0]) {
				const file = input.files[0];
				
				// Kiá»ƒm tra kÃ­ch thÆ°á»›c file
				if (file.size > 5 * 1024 * 1024) {
					alert('âš ï¸ KÃ­ch thÆ°á»›c áº£nh quÃ¡ lá»›n. Vui lÃ²ng chá»n áº£nh nhá» hÆ¡n 5MB');
					input.value = '';
					preview.innerHTML = '';
					return;
				}
				
				const reader = new FileReader();
				reader.onload = function(e) {
					preview.innerHTML = `
						<img src="${e.target.result}" alt="Preview">
						<p style="color: #856404; margin-top: 10px; font-weight: bold; text-align: center;">
							âœ“ ÄÃ£ chá»n áº£nh minh chá»©ng
						</p>
					`;
				}
				reader.readAsDataURL(file);
			}
		}

		// Validate form upload
		const uploadForm = document.getElementById('uploadProofForm');
		if (uploadForm) {
			uploadForm.addEventListener('submit', function(e) {
				const fileInput = document.getElementById('proofImageInput');
				if (!fileInput.files || !fileInput.files[0]) {
					e.preventDefault();
					alert('âš ï¸ Vui lÃ²ng chá»¥p hoáº·c chá»n áº£nh chá»©ng tá»« giao hÃ ng!');
					return false;
				}
			});
		}

		function updateLocation() {
			const statusDiv = document.getElementById('location-status');
			statusDiv.innerHTML = '<p style="color: #007bff;">â³ Äang cáº­p nháº­t vá»‹ trÃ­...</p>';
			
			if (!navigator.geolocation) {
				statusDiv.innerHTML = '<p style="color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px;">âŒ TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹</p>';
				return;
			}
			
			navigator.geolocation.getCurrentPosition(
				function(position) {
					const data = new FormData();
					data.append('latitude', position.coords.latitude);
					data.append('longitude', position.coords.longitude);
					if (shipmentId) {
						data.append('shipmentId', shipmentId);
					}

					fetch('/shipper/location/update', {
						method: 'POST',
						body: data
					})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.text();
					})
					.then(result => {
						statusDiv.innerHTML = `
							<p style="color: #28a745; font-weight: bold; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">
								âœ“ ÄÃ£ cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng!<br>
								<small>ğŸ“ Lat: ${position.coords.latitude.toFixed(6)}, Long: ${position.coords.longitude.toFixed(6)}</small>
							</p>
						`;
					})
					.catch(error => {
						console.error('Error:', error);
						statusDiv.innerHTML = `
							<p style="color: #dc3545; font-weight: bold; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">
								âœ— Lá»—i cáº­p nháº­t vá»‹ trÃ­: ${error.message}
							</p>
						`;
					});
				},
				function(error) {
					let errorMsg = '';
					switch(error.code) {
						case error.PERMISSION_DENIED:
							errorMsg = 'NgÆ°á»i dÃ¹ng tá»« chá»‘i quyá»n truy cáº­p vá»‹ trÃ­';
							break;
						case error.POSITION_UNAVAILABLE:
							errorMsg = 'ThÃ´ng tin vá»‹ trÃ­ khÃ´ng kháº£ dá»¥ng';
							break;
						case error.TIMEOUT:
							errorMsg = 'YÃªu cáº§u láº¥y vá»‹ trÃ­ háº¿t thá»i gian chá»';
							break;
						default:
							errorMsg = 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh';
					}
					statusDiv.innerHTML = `
						<p style="color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">
							âœ— KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­: ${errorMsg}
						</p>
					`;
				},
				{
					enableHighAccuracy: true,
					timeout: 10000,
					maximumAge: 0
				}
			);
		}
	</script>
</body>
</html>