<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chi ti·∫øt ƒë∆°n h√†ng</title>
<link rel="stylesheet" th:href="@{/css/shipper.css}">
<style>
/* Upload Section */
.upload-section {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	padding: 25px;
	border-radius: 12px;
	margin-top: 25px;
	color: white;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.upload-section h3 {
	color: white;
	margin-bottom: 15px;
	font-size: 1.3em;
}

/* Image Preview */
.upload-preview {
	margin-top: 15px;
	max-width: 350px;
	background: white;
	padding: 10px;
	border-radius: 8px;
}

.upload-preview img {
	width: 100%;
	border-radius: 8px;
	border: 3px solid #667eea;
}

.proof-image-display {
	max-width: 400px;
	margin-top: 15px;
	padding: 10px;
	background: #f0f8ff;
	border-radius: 8px;
}

.proof-image-display img {
	width: 100%;
	border-radius: 8px;
	border: 3px solid #17a2b8;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Buttons */
.camera-button {
	display: inline-block;
	padding: 12px 24px;
	background: #4CAF50;
	color: white;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	font-weight: bold;
	font-size: 16px;
	transition: all 0.3s;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
}

.camera-button:hover {
	background: #45a049;
	transform: translateY(-2px);
	box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.camera-button:active {
	transform: translateY(0);
}

.btn-fail {
	background: #dc3545;
	color: white;
	padding: 12px 24px;
	border: none;
	border-radius: 8px;
	font-weight: bold;
	cursor: pointer;
	transition: all 0.3s;
}

.btn-fail:hover {
	background: #c82333;
	transform: translateY(-2px);
}

.btn-location {
	background: #007bff;
	color: white;
	padding: 12px 24px;
	border: none;
	border-radius: 8px;
	font-weight: bold;
	cursor: pointer;
	transition: all 0.3s;
}

.btn-location:hover {
	background: #0056b3;
	transform: translateY(-2px);
}

.map-button {
	display: inline-block;
	padding: 10px 20px;
	background: #007bff;
	color: white;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	text-decoration: none;
	transition: all 0.3s;
	margin-top: 10px;
}

.map-button:hover {
	background: #0056b3;
	transform: translateY(-2px);
}

/* Form Groups */
.form-group {
	margin-bottom: 20px;
}

.form-group label {
	display: block;
	margin-bottom: 8px;
	font-weight: bold;
	color: white;
}

.form-group textarea {
	width: 100%;
	padding: 12px;
	border: 2px solid rgba(255, 255, 255, 0.3);
	border-radius: 8px;
	font-size: 14px;
	background: rgba(255, 255, 255, 0.9);
	color: #333;
	box-sizing: border-box;
}

.form-group textarea:focus {
	outline: none;
	border-color: #4CAF50;
	background: white;
}

/* Action Sections */
.action-section {
	background: #f8f9fa;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #e9ecef;
}

.action-section h3 {
	color: #495057;
	margin-bottom: 15px;
}

.action-buttons {
	display: flex;
	gap: 10px;
	margin-top: 20px;
	flex-wrap: wrap;
}

.location-update-section {
	background: #e7f3ff;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #007bff;
}

.location-update-section h3 {
	color: #004085;
	margin-bottom: 15px;
}

.fail-section {
	background: #fff3cd;
	padding: 20px;
	border-radius: 12px;
	margin-top: 20px;
	border: 2px solid #ffc107;
}

.fail-section h3 {
	color: #856404;
	margin-bottom: 15px;
}

.fail-section .form-group label {
	color: #856404;
}

/* Status Indicators */
.status-indicator {
	display: inline-block;
	padding: 8px 16px;
	border-radius: 20px;
	font-weight: bold;
	margin: 10px 0;
}

.status-pending {
	background: #fff3cd;
	color: #856404;
}

.status-transit, .status-in_transit {
	background: #d1ecf1;
	color: #0c5460;
}

.status-delivered {
	background: #d4edda;
	color: #155724;
}

.status-failed {
	background: #f8d7da;
	color: #721c24;
}

/* Messages */
.success-message {
	background: #d4edda;
	color: #155724;
	padding: 15px;
	border-radius: 8px;
	margin-bottom: 20px;
	border: 1px solid #c3e6cb;
}

.error-message {
	background: #f8d7da;
	color: #721c24;
	padding: 15px;
	border-radius: 8px;
	margin-bottom: 20px;
	border: 1px solid #f5c6cb;
}

#location-status {
	margin-top: 10px;
	padding: 10px;
	border-radius: 5px;
	font-weight: bold;
}

/* Timeline */
.timeline {
	position: relative;
	padding: 20px 0;
	margin-bottom: 30px;
}

.timeline-item {
	display: flex;
	gap: 15px;
	margin-bottom: 20px;
	position: relative;
}

.timeline-icon {
	width: 40px;
	height: 40px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 20px;
	flex-shrink: 0;
}

.timeline-content {
	flex: 1;
	padding: 15px;
	background: white;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.step-completed .timeline-icon {
	background: #28a745;
	color: white;
}

.step-active .timeline-icon {
	background: #ffc107;
	color: white;
}

.step-pending .timeline-icon {
	background: #6c757d;
	color: white;
}

/* Warning Section */
.warning-section {
	background: #fff3cd;
	padding: 20px;
	border-radius: 10px;
	border: 2px solid #ffc107;
	margin-top: 20px;
}

.warning-section h3 {
	color: #856404;
	margin-bottom: 10px;
}

.warning-section p {
	color: #856404;
	margin: 0;
}
</style>
</head>
<body>
	<div th:replace="~{fragments/shipper-header :: header}"></div>
	
	<div class="container">
		<!-- Alert Messages -->
		<div th:if="${success}" class="success-message" th:text="${success}"></div>
		<div th:if="${error}" class="error-message" th:text="${error}"></div>

		<!-- Page Header -->
		<div class="page-header">
			<h1>Chi ti·∫øt ƒë∆°n h√†ng</h1>
			<a th:href="@{/shipper/orders}" class="btn-secondary">‚Üê Quay l·∫°i</a>
		</div>

		<!-- Timeline Progress (ch·ªâ hi·ªÉn th·ªã khi c√≥ shipment) -->
		<div class="timeline" th:if="${shipment != null}">
			<div class="timeline-item"
				th:classappend="${shipment.pickupTime != null ? 'step-completed' : 'step-pending'}">
				<div class="timeline-icon">üì¶</div>
				<div class="timeline-content">
					<strong>1. Nh·∫≠n h√†ng t·ª´ kho</strong>
					<p th:if="${shipment.pickupTime}"
						th:text="'‚úì ' + ${#temporals.format(shipment.pickupTime, 'dd/MM/yyyy HH:mm')}"></p>
					<p th:unless="${shipment.pickupTime}" style="color: #6c757d;">Ch∆∞a nh·∫≠n h√†ng</p>
				</div>
			</div>

			<div class="timeline-item"
				th:classappend="${shipment.status.name() == 'IN_TRANSIT' ? 'step-active' : (shipment.status.name() == 'DELIVERED' ? 'step-completed' : 'step-pending')}">
				<div class="timeline-icon">üöö</div>
				<div class="timeline-content">
					<strong>2. ƒêang v·∫≠n chuy·ªÉn</strong>
					<p th:if="${shipment.status.name() == 'IN_TRANSIT'}">‚è≥ ƒêang giao h√†ng</p>
					<p th:if="${shipment.status.name() == 'DELIVERED'}">‚úì ƒê√£ ho√†n th√†nh v·∫≠n chuy·ªÉn</p>
					<p th:if="${shipment.status.name() == 'PENDING'}" style="color: #6c757d;">Ch∆∞a b·∫Øt ƒë·∫ßu</p>
				</div>
			</div>

			<div class="timeline-item"
				th:classappend="${shipment.status.name() == 'DELIVERED' ? 'step-completed' : 'step-pending'}">
				<div class="timeline-icon">‚úÖ</div>
				<div class="timeline-content">
					<strong>3. Giao h√†ng th√†nh c√¥ng</strong>
					<p th:if="${shipment.deliveryTime}"
						th:text="'‚úì ' + ${#temporals.format(shipment.deliveryTime, 'dd/MM/yyyy HH:mm')}"></p>
					<p th:unless="${shipment.deliveryTime}" style="color: #6c757d;">Ch∆∞a ho√†n th√†nh</p>
				</div>
			</div>
		</div>

		<!-- Th√¥ng tin ƒë∆°n h√†ng -->
		<div class="detail-grid">
			<div class="detail-card">
				<h3>üìã Th√¥ng tin ƒë∆°n</h3>
				<p><strong>M√£ ƒë∆°n:</strong> <span th:text="${order.orderCode}"></span></p>
				<p><strong>Tr·∫°ng th√°i:</strong> <span th:class="'badge badge-' + ${order.status}" th:text="${order.status}"></span></p>
				<p><strong>Ph√≠ v·∫≠n chuy·ªÉn:</strong> <span th:text="${#numbers.formatDecimal(order.shipmentFee, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span></p>
				<p><strong>Ghi ch√∫:</strong> <span th:text="${order.notes ?: '-'}"></span></p>
			</div>

			<div class="detail-card">
				<h3>üì§ Ng∆∞·ªùi g·ª≠i</h3>
				<p><strong>T√™n:</strong> <span th:text="${order.senderName}"></span></p>
				<p><strong>SƒêT:</strong> <a th:href="'tel:' + ${order.senderPhone}" th:text="${order.senderPhone}" style="color: #007bff; text-decoration: none;">üìû</a></p>
				<p><strong>ƒê·ªãa ch·ªâ:</strong> <span th:text="${order.senderAddress}"></span></p>
			</div>

			<div class="detail-card">
				<h3>üì• Ng∆∞·ªùi nh·∫≠n</h3>
				<p><strong>T√™n:</strong> <span th:text="${order.recipientName}"></span></p>
				<p><strong>SƒêT:</strong> <a th:href="'tel:' + ${order.recipientPhone}" th:text="${order.recipientPhone}" style="color: #007bff; text-decoration: none;">üìû</a></p>
				<p><strong>ƒê·ªãa ch·ªâ:</strong> <span th:text="${order.recipientAddress}"></span></p>
				<button onclick="openMap()" class="map-button">üó∫Ô∏è M·ªü b·∫£n ƒë·ªì</button>
			</div>
		</div>

		<!-- Danh s√°ch ki·ªán h√†ng -->
		<div class="section">
			<h3>üì¶ Danh s√°ch ki·ªán h√†ng</h3>
			<table>
				<thead>
					<tr>
						<th>M√£ ki·ªán</th>
						<th>M√¥ t·∫£</th>
						<th>Tr·ªçng l∆∞·ª£ng</th>
						<th>K√≠ch th∆∞·ªõc</th>
						<th>Tr·∫°ng th√°i</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="pkg : ${packages}">
						<td th:text="${pkg.packageCode}"></td>
						<td th:text="${pkg.description}"></td>
						<td th:text="${pkg.weight} + ' kg'"></td>
						<td th:text="${pkg.length} + 'x' + ${pkg.width} + 'x' + ${pkg.height} + ' cm'"></td>
						<td><span th:class="'badge badge-' + ${pkg.status}" th:text="${pkg.status}"></span></td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Th√¥ng tin giao h√†ng -->
		<div class="section" th:if="${shipment != null}">
			<h3>üöö Th√¥ng tin giao h√†ng</h3>
			<div class="detail-card">
				<p><strong>M√£ giao h√†ng:</strong> <span th:text="${shipment.shipmentCode}"></span></p>
				<p><strong>Tr·∫°ng th√°i:</strong> <span th:class="'status-indicator status-' + ${shipment.status.name().toLowerCase()}" th:text="${shipment.status}"></span></p>
				<p th:if="${shipment.shipper != null}"><strong>Shipper:</strong> <span th:text="${shipment.shipper.name + ' (' + shipment.shipper.code + ')'}"></span></p>
				<p th:if="${shipment.pickupTime}"><strong>‚è∞ Th·ªùi gian l·∫•y:</strong> <span th:text="${#temporals.format(shipment.pickupTime, 'dd/MM/yyyy HH:mm')}"></span></p>
				<p th:if="${shipment.deliveryTime}"><strong>‚úÖ Th·ªùi gian giao:</strong> <span th:text="${#temporals.format(shipment.deliveryTime, 'dd/MM/yyyy HH:mm')}"></span></p>
				<p th:if="${shipment.notes}"><strong>üìù Ghi ch√∫:</strong> <span th:text="${shipment.notes}"></span></p>

				<!-- Hi·ªÉn th·ªã ·∫£nh ƒë√£ upload -->
				<div th:if="${shipment.proofImageUrl}" class="proof-image-display">
					<strong>üì∏ ·∫¢nh ch·ª©ng t·ª´ ƒë√£ giao:</strong><br>
					<img th:src="${shipment.proofImageUrl}" alt="·∫¢nh ch·ª©ng t·ª´ giao h√†ng">
				</div>
			</div>
		</div>

		<!-- ACTION 1: PENDING - Nh·∫≠n h√†ng v√† b·∫Øt ƒë·∫ßu -->
		<div class="action-section" th:if="${shipment != null && shipment.status.name() == 'PENDING'}">
			<h3>üéØ H√†nh ƒë·ªông ti·∫øp theo</h3>
			<p style="color: #666; margin-bottom: 15px;">‚ö†Ô∏è Vui l√≤ng nh·∫≠n h√†ng t·ª´ kho v√† b·∫Øt ƒë·∫ßu v·∫≠n chuy·ªÉn</p>
			<div class="action-buttons">
				<form th:action="@{/shipper/shipments/{id}/receive(id=${shipment.id})}" method="post" style="display: inline-block;">
					<button type="submit" class="btn-primary">üì¶ 1. X√°c nh·∫≠n nh·∫≠n h√†ng</button>
				</form>
				<form th:action="@{/shipper/shipments/{id}/start(id=${shipment.id})}" method="post" style="display: inline-block;">
					<button type="submit" class="btn-success">üöö 2. B·∫Øt ƒë·∫ßu v·∫≠n chuy·ªÉn</button>
				</form>
			</div>
		</div>

		<!-- ACTION 2: IN_TRANSIT - Upload ·∫£nh v√† ho√†n th√†nh -->
		<div class="upload-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>üì∑ Ho√†n th√†nh giao h√†ng</h3>
			<p style="margin-bottom: 15px; font-size: 14px;">‚úÖ ƒê∆°n h√†ng ƒëang v·∫≠n chuy·ªÉn. Vui l√≤ng ch·ª•p ·∫£nh x√°c nh·∫≠n khi giao h√†ng th√†nh c√¥ng.</p>

			<form th:action="@{/shipper/shipments/{id}/complete(id=${shipment.id})}" method="post" enctype="multipart/form-data" id="uploadProofForm">
				<div class="form-group">
					<label>üì∏ ·∫¢nh ch·ª©ng t·ª´ giao h√†ng *</label>
					<button type="button" class="camera-button" onclick="document.getElementById('proofImageInput').click()">
						üì∑ Ch·ª•p ·∫£nh / Ch·ªçn t·ª´ th∆∞ vi·ªán
					</button>
					<input type="file" id="proofImageInput" name="proofImage" accept="image/*" capture="environment" style="display: none;" onchange="previewImage(this)" required>
					<div id="imagePreview" class="upload-preview"></div>
				</div>

				<div class="form-group">
					<label>üìù Ghi ch√∫ (t√πy ch·ªçn)</label>
					<textarea name="notes" rows="3" placeholder="Ghi ch√∫ v·ªÅ vi·ªác giao h√†ng (v√≠ d·ª•: ƒê√£ giao cho ng∆∞·ªùi nh·∫≠n, k√Ω nh·∫≠n ƒë·∫ßy ƒë·ªß...)"></textarea>
				</div>

				<button type="submit" class="btn-success btn-lg" style="width: 100%;">‚úì Ho√†n th√†nh giao h√†ng</button>
			</form>
		</div>

		<!-- ACTION 3: IN_TRANSIT - C·∫≠p nh·∫≠t v·ªã tr√≠ -->
		<div class="location-update-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>üìç C·∫≠p nh·∫≠t v·ªã tr√≠</h3>
			<p style="color: #004085; margin-bottom: 15px;">C·∫≠p nh·∫≠t v·ªã tr√≠ hi·ªán t·∫°i ƒë·ªÉ kh√°ch h√†ng theo d√µi ƒë∆°n h√†ng</p>
			<button onclick="updateLocation()" class="btn-location">üì° C·∫≠p nh·∫≠t v·ªã tr√≠ hi·ªán t·∫°i</button>
			<div id="location-status"></div>
		</div>

		<!-- ACTION 4: B√°o th·∫•t b·∫°i -->
		<div class="fail-section" th:if="${shipment != null && shipment.status.name() == 'IN_TRANSIT'}">
			<h3>‚ö†Ô∏è B√°o giao h√†ng th·∫•t b·∫°i</h3>
			<p style="color: #856404; margin-bottom: 15px;">Ch·ªâ s·ª≠ d·ª•ng khi kh√¥ng th·ªÉ giao h√†ng (ng∆∞·ªùi nh·∫≠n kh√¥ng c√≥ m·∫∑t, ƒë·ªãa ch·ªâ sai, t·ª´ ch·ªëi nh·∫≠n h√†ng...)</p>

			<form th:action="@{/shipper/shipments/{id}/fail(id=${shipment.id})}" method="post" enctype="multipart/form-data" id="failForm" onsubmit="return confirm('‚ö†Ô∏è X√°c nh·∫≠n b√°o giao h√†ng TH·∫§T B·∫†I?');">
				<div class="form-group">
					<label>üìù L√Ω do th·∫•t b·∫°i *</label>
					<textarea name="notes" rows="3" required placeholder="Vui l√≤ng m√¥ t·∫£ chi ti·∫øt l√Ω do kh√¥ng th·ªÉ giao h√†ng..."></textarea>
				</div>

				<div class="form-group">
					<label>üì∏ ·∫¢nh minh ch·ª©ng (n·∫øu c√≥)</label>
					<button type="button" class="camera-button" style="background: #ffc107;" onclick="document.getElementById('failImageInput').click()">
						üì∑ Ch·ª•p ·∫£nh minh ch·ª©ng
					</button>
					<input type="file" id="failImageInput" name="proofImage" accept="image/*" capture="environment" style="display: none;" onchange="previewFailImage(this)">
					<div id="failImagePreview" class="upload-preview"></div>
				</div>

				<button type="submit" class="btn-fail" style="width: 100%;">‚ö†Ô∏è X√°c nh·∫≠n giao h√†ng th·∫•t b·∫°i</button>
			</form>
		</div>

		<!-- C·∫£nh b√°o ch∆∞a c√≥ shipment -->
		<div class="warning-section" th:if="${shipment == null}">
			<h3>‚ö†Ô∏è ƒê∆°n h√†ng ch∆∞a c√≥ Shipment</h3>
			<p>Vui l√≤ng ch·ªù warehouse t·∫°o shipment cho ƒë∆°n h√†ng n√†y.</p>
			
			<!-- N√∫t t·∫°o shipment cho warehouse (n·∫øu c·∫ßn) -->
			<div th:if="${order.status.name() == 'CHO_GIAO'}" style="margin-top: 15px;">
				<form th:action="@{/warehouse/orders/{id}/create-shipment(id=${order.id})}" method="post">
					<button type="submit" class="btn-primary">üì¶ T·∫°o Shipment</button>
				</form>
			</div>
		</div>
	</div>

	<script th:inline="javascript">
		/*<![CDATA[*/
		const orderRecipientAddress = /*[[${order.recipientAddress}]]*/ '';
		const shipmentId = /*[[${shipment?.id}]]*/ null;
		/*]]>*/

		function openMap() {
			if (!orderRecipientAddress) {
				alert('‚ö†Ô∏è Kh√¥ng c√≥ ƒë·ªãa ch·ªâ ng∆∞·ªùi nh·∫≠n');
				return;
			}
			window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(orderRecipientAddress)}`, '_blank');
		}

		function previewImage(input) {
			const preview = document.getElementById('imagePreview');
			
			if (input.files && input.files[0]) {
				const file = input.files[0];
				
				// Ki·ªÉm tra k√≠ch th∆∞·ªõc file (max 5MB)
				if (file.size > 5 * 1024 * 1024) {
					alert('‚ö†Ô∏è K√≠ch th∆∞·ªõc ·∫£nh qu√° l·ªõn. Vui l√≤ng ch·ªçn ·∫£nh nh·ªè h∆°n 5MB');
					input.value = '';
					preview.innerHTML = '';
					return;
				}
				
				const reader = new FileReader();
				reader.onload = function(e) {
					preview.innerHTML = `
						<img src="${e.target.result}" alt="Preview">
						<p style="color: #28a745; margin-top: 10px; font-weight: bold; text-align: center;">
							‚úì ƒê√£ ch·ªçn ·∫£nh
						</p>
					`;
				}
				reader.readAsDataURL(file);
			}
		}

		function previewFailImage(input) {
			const preview = document.getElementById('failImagePreview');
			
			if (input.files && input.files[0]) {
				const file = input.files[0];
				
				// Ki·ªÉm tra k√≠ch th∆∞·ªõc file
				if (file.size > 5 * 1024 * 1024) {
					alert('‚ö†Ô∏è K√≠ch th∆∞·ªõc ·∫£nh qu√° l·ªõn. Vui l√≤ng ch·ªçn ·∫£nh nh·ªè h∆°n 5MB');
					input.value = '';
					preview.innerHTML = '';
					return;
				}
				
				const reader = new FileReader();
				reader.onload = function(e) {
					preview.innerHTML = `
						<img src="${e.target.result}" alt="Preview">
						<p style="color: #856404; margin-top: 10px; font-weight: bold; text-align: center;">
							‚úì ƒê√£ ch·ªçn ·∫£nh minh ch·ª©ng
						</p>
					`;
				}
				reader.readAsDataURL(file);
			}
		}

		// Validate form upload
		const uploadForm = document.getElementById('uploadProofForm');
		if (uploadForm) {
			uploadForm.addEventListener('submit', function(e) {
				const fileInput = document.getElementById('proofImageInput');
				if (!fileInput.files || !fileInput.files[0]) {
					e.preventDefault();
					alert('‚ö†Ô∏è Vui l√≤ng ch·ª•p ho·∫∑c ch·ªçn ·∫£nh ch·ª©ng t·ª´ giao h√†ng!');
					return false;
				}
			});
		}

		function updateLocation() {
			const statusDiv = document.getElementById('location-status');
			statusDiv.innerHTML = '<p style="color: #007bff;">‚è≥ ƒêang c·∫≠p nh·∫≠t v·ªã tr√≠...</p>';
			
			if (!navigator.geolocation) {
				statusDiv.innerHTML = '<p style="color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px;">‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã</p>';
				return;
			}
			
			navigator.geolocation.getCurrentPosition(
				function(position) {
					const data = new FormData();
					data.append('latitude', position.coords.latitude);
					data.append('longitude', position.coords.longitude);
					if (shipmentId) {
						data.append('shipmentId', shipmentId);
					}

					fetch('/shipper/location/update', {
						method: 'POST',
						body: data
					})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.text();
					})
					.then(result => {
						statusDiv.innerHTML = `
							<p style="color: #28a745; font-weight: bold; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">
								‚úì ƒê√£ c·∫≠p nh·∫≠t v·ªã tr√≠ th√†nh c√¥ng!<br>
								<small>üìç Lat: ${position.coords.latitude.toFixed(6)}, Long: ${position.coords.longitude.toFixed(6)}</small>
							</p>
						`;
					})
					.catch(error => {
						console.error('Error:', error);
						statusDiv.innerHTML = `
							<p style="color: #dc3545; font-weight: bold; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">
								‚úó L·ªói c·∫≠p nh·∫≠t v·ªã tr√≠: ${error.message}
							</p>
						`;
					});
				},
				function(error) {
					let errorMsg = '';
					switch(error.code) {
						case error.PERMISSION_DENIED:
							errorMsg = 'Ng∆∞·ªùi d√πng t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠';
							break;
						case error.POSITION_UNAVAILABLE:
							errorMsg = 'Th√¥ng tin v·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng';
							break;
						case error.TIMEOUT:
							errorMsg = 'Y√™u c·∫ßu l·∫•y v·ªã tr√≠ h·∫øt th·ªùi gian ch·ªù';
							break;
						default:
							errorMsg = 'L·ªói kh√¥ng x√°c ƒë·ªãnh';
					}
					statusDiv.innerHTML = `
						<p style="color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">
							‚úó Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠: ${errorMsg}
						</p>
					`;
				},
				{
					enableHighAccuracy: true,
					timeout: 10000,
					maximumAge: 0
				}
			);
		}
	</script>
</body>
</html>